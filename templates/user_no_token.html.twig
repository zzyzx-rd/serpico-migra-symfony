{% extends "layout.html.twig" %}

{% block title %}
    {% trans %}user_no_token.title{% endtrans %}
{% endblock %}


  {% block css %}
      <style>

          img{
            width: inherit;
          }

          .email-field{
            position: relative;
          }

          .email-field button{
            position: absolute;
            right: 0;
            top: 0%;
          }

      </style>
      <script>
        var rurl = "{{ path('resetPassword') }}";
      </script>

  {% endblock %}


{% block pagename %}
    {% trans %}user_no_token.mobile_header_title{% endtrans %}
{% endblock %}

{% block username %}
  {{ currentuser.firstname }}
  {{ currentuser.lastname }}
{% endblock %}

{% block content %}

      {% include "components/background_grid.html.twig" %}

      <div class="small-container">
          <img src="{{ asset('lib/img/logo_dd_p_l.png') }}">
          <div class="card-panel purple lighten-5">
            <div class="row center no-margin">
              <h5>{% trans %}user_no_token.title{% endtrans %}</h5>
              <p>{% trans %}user_no_token.description{% endtrans %}</p>
            </div>
            <div class="row">
              <form id="retrievePwdForm" action="" method="post">
                <div class="input-field email-field btn-disabled">
                  <input type="email" name="email" required="required">
                  <button type="submit" name="" value="home" class="btn waves-effect waves-light disabled-btn btn-reduced-padding">{% trans %}landing.retrieve_pwd.submit{% endtrans %}</button>
                </div>
              </form>
            </div>
            <div class="row col center">
              <div class="button-field">
                <a class="btn btn-large waves-effect waves-light" href="{{ url('login') }}">{% trans %}user_no_token.home_button_title{% endtrans %}</a>
              </div>
            </div>
          </div>
      </div>

      <div id="retrievePwd" class="modal">
          <div class="container">
              <div class="modal-content">
                  <p>{% trans %}landing.retrieve_pwd.msg{% endtrans %}</p>
                  <p>{% trans %}landing.retrieve_pwd.msg_2{% endtrans %}</p>
              </div>
              <form id="retrievePwdForm" action="" method="post">
                  <div class="input-field email-field btn-disabled">
                      <input type="email" name="email" required="required"/>
                      <button type="submit" name="" value="home" class="btn waves-effect waves-light disabled-btn modal-close">{% trans %}landing.retrieve_pwd.submit{% endtrans %}</button>
                  </div>
              </form>
          </div>
      </div>
      <div id="retrievePwdSuccess" class="modal">
          <div class="modal-content">
              <p>{% trans %}landing.retrieve_pwd.success_msg{% endtrans %}</p>
          </div>
          <div class="modal-footer">
              <button class="btn waves-effect waves-light modal-close">{% trans %}Ok{% endtrans %}</button>
          </div>
      </div>
{% endblock %}

{% block javascripts %}
  <script>
    
    $(function(){
      $('input[type="email"]').on('keyup',function(){
          if(isEmail($(this).val())){
            $('.email-field button').removeClass('disabled-btn');
          }
      })
       $('#retrievePwdForm').on('submit',function(e){
        e.preventDefault();
        var formSerialize =  $(this).serialize();
        $.post(rurl, formSerialize)
        .done(function(data){
            $('.modal').modal('close');
            $('#retrievePwdForm').find("[type=email]").val("");
            $('#retrievePwdSuccess').modal('open');
        })
        .fail(function(data){
            console.log(data);
        })
      })
    });
  
  </script>
{% endblock %}

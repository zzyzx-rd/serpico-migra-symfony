{% extends "layout.html.twig" %}

{% block title %}
    {% trans %}template_manage.page_title{% endtrans %}
{% endblock %}

{% block css %}
  <script>var deleteUrl="{{ url('templateDelete',{'tmpId' : 0}) }}";</script>

{% endblock %}

{% block pagename %}
    {% trans %}template_manage.mobile_header_title {% endtrans %}
{% endblock %}

{% block username %}
    {{ currentuser.firstname }} {{ currentuser.lastname }}
{% endblock %}

{% set colors = ["red", "pink", "purple", "indigo", "blue", "cyan", "teal", "lime", "yellow", "amber", "orange","brown"] %}

{# get current date to compare it after #}
{% set now = "now"|date("Y/m/d") %}

{% block content %}

  <section style="width:95%;margin:auto">

        {% if templates is not empty %}

            <div>

                {% for activity in templates %}

                <ul class="collapsible template" data-collapsible="accordion">
                    <li>
                        <div class="collapsible-header reduced-padding user-single-element lighten-5">
                            <i class="fa fa-fw fa-chevron-down no-margin"></i>
                            <i class="fa fa-fw fa-chevron-right no-margin"></i>
                            <!-- if pour la photo du user  pour un : if user['picture'] != null -->
                            <ul class="collection flex-center" style="width:100%">


                                <li class="username-element">
                                    <div class="user-title">
                                                {% if activity.name|length > 20 %}
                                                    {{ activity.name|slice(0, 30) ~ '...' }}
                                                {% else %}
                                                    {{ activity.name }}
                                                {% endif %}
                                    </div>
                                </li>

                                <li style="margin-left:auto;margin-right:10px"><a href="{{ url('oldActivityDefinition',{'elmt': 'template', 'elmtId' : activity.id})}}" class="not-collapse waves-effect waves-light btn">{% trans %}template_manage.modify_btn{% endtrans %}</a></li>
                                <li><i href="#deleteTemplate" class="fa fa-trash modal-trigger not-collapse" data-tid="{{ activity.id }}"></i></li>

                            </ul>
                        </div>
                        <div class="collapsible-body">
                            <div class="collapse" id="details">
                                <ul class="flex-center row no-margin" style="justify-content: space-between;">
                                    <li><h4 class="department-name no-margin">{% trans %}activities.details{% endtrans %}</h4></li>
                                </ul>
                            </div>
                            <ul class="collection">

                                {% set activityHasResults = false %}

                                {% for stage in activity.stages %}

                                    {% set selectedTeam = null %}

                                    <li class="collection-item">

                                        {% if activity.stages|length > 1 %}
                                            <ul class="flex-center row" style="justify-content: space-between;">
                                                <li><h4 class="department-name">{{ stage.name }}</h4></li>
                                            </ul>

                                        {% endif %}
                                        <div class="row">
                                            <div class="col s6 m4">
                                                <i class="fa fa-cube" aria-hidden="true"></i> {% trans %}activities.criteria{% endtrans %}
                                            </div>
                                            <div class="col s6 m8">
                                                <ul class="flex-center">
                                                {% for criterion in stage.criteria %}
                                                    <li>
                                                        <i class="fa fa-{% if criterion.cName.icon is null %}cube{% else %}{{ criterion.cName.icon.name }}{% endif %} tooltipped" data-position="top"
                                                        data-tooltip="{{ criterion.cName.name }}" style="font-size:1.3rem!important;margin-right: 10px;">
                                                        </i>
                                                    </li>
                                                {% endfor %}
                                                </ul>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col s6 m4">
                                                <i class="far fa-clock" aria-hidden="true"></i> {% trans %}activities.activity_period{% endtrans %}
                                            </div>
                                            <div class="col s6 m4 desktop-dates">{{ stage.startdate|localizeddate('long', 'none') }} - {{ stage.enddate|localizeddate('long', 'none') }}</div>
                                            <div class="col s6 m4 mobile-dates">{{ stage.startdate|localizeddate('short', 'none', null, null, 'dd/MM') }} - {{ stage.enddate|localizeddate('short', 'none', null, null, 'dd/MM') }}</div>
                                        </div>

                                        <div class="row">
                                            <div class="col s6 m4">
                                                <i class="far fa-clock" aria-hidden="true"></i> {% trans %}activities.grading_period{% endtrans %}
                                            </div>
                                            <div class="col s6 m4 desktop-dates">{{ stage.gstartdate|localizeddate('long', 'none') }} - {{ stage.genddate|localizeddate('long', 'none') }}</div>
                                            <div class="col s6 m4 mobile-dates">{{ stage.gstartdate|localizeddate('short', 'none', null, null, 'dd/MM') }} - {{ stage.genddate|localizeddate('short', 'none', null, null, 'dd/MM') }}</div>
                                        </div>

                                        <div class="row">
                                            <div class="col s10 m4">
                                                <i class="fa fa-users" aria-hidden="true"></i>{% trans %}activities.participants{% endtrans %}
                                            </div>
                                            <div class="col s2 m4">
                                                {{ stage.criteria[0].participants|length }}
                                            </div>
                                        </div>

                                        <div class="row">
                                            <ul class="participants">
                                                {% for participant in stage.criteria[0].participants %}
                                                    {% if participant.team is null %}
                                                        <li class="participant" style="position: relative">
                                                            <ul class="flex-center" style="flex-direction: column">
                                                                <li>
                                                                    <div class="picture-frame">
                                                                        <img class="user-picture" src="{{ (participant.user(app).picture != "") ? asset('lib/img/' ~ participant.user(app).picture) : asset('lib/img/no-picture.png') }}" alt="">
                                                                    </div>
                                                                </li>
                                                                <li>
                                                                    <div class="participant-name">
                                                                        <span>{{ participant.user(app).firstname }}</span>
                                                                        {% if participant.type == 0 %}
                                                                            <span style="background-color: purple;color: white;padding: 0px 5px;border-radius: 100%;" class="tooltipped" data-position="top" data-tooltip="{% trans %}tooltip.activity.tp_participant_msg{% endtrans %}" data-delay="50">T</span>
                                                                        {% elseif participant.type == -1 %}
                                                                            <span style="background-color: orange;color: white;padding: 0px 5px;border-radius: 100%;" class="tooltipped" data-position="top" data-tooltip="{% trans %}tooltip.activity.passive_participant_msg{% endtrans %}" data-delay="50">P</span>
                                                                        {% endif %}
                                                                        {% if participant.precomment is not null and participant.precomment != "" %}
                                                                            <i class="fa fa-flag tooltipped" data-position="top" data-tooltip="{{ participant.precomment }}" data-delay="50" style="color:#15a6ae;" title="{% trans %}grade.precomment.button_existing_title{% endtrans %}"></i>
                                                                        {% endif %}
                                                                    </div>
                                                                </li>
                                                            </ul>
                                                        </li>
                                                    {% else %}
                                                        {% if selectedTeam is null or selectedTeam != participant.team %}
                                                            <li class="participant" style="position: relative">
                                                                    <ul class="flex-center" style="flex-direction: column">
                                                                        <li>
                                                                            {% if participant.team.picture != "" and participant.team.picture is not null %}
                                                                            <div class="picture-frame">
                                                                                <img class="user-picture" src="{{ participant.team.picture }}" alt="">
                                                                            </div>
                                                                            {% else %}
                                                                                <div class="picture-frame flex-center" style="background-color: #b3b3b3; border-radius: 100%; height: 50px; justify-content: center">
                                                                                    <i class="fa fa-users" style="color: white; font-size: 2rem; margin: 0px;"></i>
                                                                                </div>
                                                                            {% endif %}
                                                                        </li>
                                                                        <li>
                                                                            <div class="participant-name">
                                                                                <span>{{ participant.team.name }}</span>
                                                                                {% if participant.type == 0 %}
                                                                                    <span style="background-color: purple;color: white;padding: 0px 5px;border-radius: 100%;" class="tooltipped" data-position="top" data-tooltip="{% trans %}tooltip.activity.tp_participant_msg{% endtrans %}" data-delay="50">T</span>
                                                                                {% elseif participant.type == -1 %}
                                                                                    <span style="background-color: orange;color: white;padding: 0px 5px;border-radius: 100%;" class="tooltipped" data-position="top" data-tooltip="{% trans %}tooltip.activity.passive_participant_msg{% endtrans %}" data-delay="50">P</span>
                                                                                {% endif %}
                                                                                {% if participant.precomment is not null and participant.precomment != "" %}
                                                                                    <i class="fa fa-flag tooltipped" data-position="top" data-tooltip="{{ participant.precomment }}" data-delay="50" style="color:#15a6ae;" title="{% trans %}grade.precomment.button_existing_title{% endtrans %}"></i>
                                                                                {% endif %}
                                                                            </div>
                                                                        </li>
                                                                    </ul>
                                                            </li>
                                                            {% set selectedTeam = participant.team %}
                                                        {% endif %}
                                                    {% endif %}
                                                {% endfor %}
                                            </ul>
                                        </div>
                                    </li>
                                {% endfor %}
                            </ul>
                        </div>
                    </li>

                </ul>

                {% endfor %}

            </div>
            <div id="deleteTemplate" class="modal">
                <div class="modal-content">
                    <p>{% trans %}template_manage.delete.msg{% endtrans %}</p>
                </div>
                <div class="modal-footer">
                    <a class=" modal-action modal-close waves-effect waves-green btn-large delete-button">{% trans %}template_manage.delete.confirm{% endtrans %}</a>
                    <a class=" modal-action modal-close waves-effect waves-green btn-flat red-text">{% trans %}template_manage.delete.decline{% endtrans %}</a>
                </div>
            </div>
        {% else %}
                {#<div class="ul-center">#}
                    <ul class="center" style="
                        display: flex;
                        align-items: center;
                        height: 300px;
                        flex-direction: column;
                        justify-content: center;
                    ">
                        <li>
                            <i class="far fa-2x fa-file"></i>
                        </li>
                        <li>
                            <h5>{% trans %}template_manage.no_templates_msg{% endtrans %}</h5>
                        </li>
                    </ul>
                {#</div>#}

        {% endif %}
        {% if templates is empty %}
            <div class="row action-buttons center-button">
        {% endif %}
        <a class="btn waves-effect waves-light insert-btn" href="{{ path('activityInitialisation',{'elmt' : 'template'}) }}" style="width:fit-content;">
            <div style="display: inline-block;position:relative">
                <i class="far fa-file"></i>
                <i class="fa fa-plus" style="position: absolute;left: 20%;top: 5%;font-size: 70%;"></i>
            </div>
            <span>{% trans %}template_manage.create_btn{% endtrans %}</span>

        </a>
        {% if templates is empty %}
            </div>
        {% endif %}



        <div class="row action-buttons" style="margin-top: 20px">
            <div class="button-field">
                <a class="btn-large waves-effect waves-light modal-trigger" href="{{path('firmSettings')}}" > Retour aux paramètres</a>
            </div>
        </div>


</section>

{% endblock %}

{% block javascripts %}
    <script src="{{ asset('js/template_manage.js') }}"></script>
{% endblock %}
